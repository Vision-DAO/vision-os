[env]
CARGO_MAKE_EXTEND_WORKSPACE_MAKEFILE = true

[tasks.run]
workspace = false
dependencies = ["build_all_flow", "run_scheduler"]

[tasks.test]
workspace = false
dependencies = ["build_all_flow", "run_test_runner"]

[tasks.build]
workspace = false
dependencies = ["build_all_flow", "build_scheduler"]

[tasks.build_scheduler]
workspace = false
script = '''
cd beacon_dao-scheduler && wasm-pack build --target web --features "wasm module" --release
'''

[tasks.run_scheduler]
workspace = false
script = '''
cd beacon_dao-scheduler && cargo run --features cli
'''

[tasks.run_test_runner]
workspace = false
script = '''
cd beacon_dao-test && cargo run --features cli
'''

[tasks.build_all_flow]
run_task = { name = "build_all", fork = true }

[tasks.build_all]
command = "cargo"
args = ["build", "--target", "wasm32-unknown-unknown", "--release", "--features", "module"]

[tasks.update]
run_task = { name = "update_all", fork = true }

[tasks.update_all]
script = '''cargo update'''